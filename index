import React, { useState, useEffect } from 'react';
import { 
  MessageSquare, 
  BookOpen, 
  CheckCircle, 
  Brain, 
  Plus, 
  Save, 
  Trash2, 
  Search, 
  Menu, 
  X,
  ChevronRight,
  Info,
  Dna,
  Microscope,
  Leaf,
  ExternalLink
} from 'lucide-react';

const App = () => {
  const [activeTab, setActiveTab] = useState('clarification');
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [messages, setMessages] = useState([
    { role: 'bot', content: "Bonjour ! Je suis BioTuteur. Comment puis-je vous aider dans vos études de biologie aujourd'hui ?" }
  ]);
  const [inputValue, setInputValue] = useState('');
  const [glossaryTerm, setGlossaryTerm] = useState('');

  // Logo BioTuteur (Profil de tête stylisé)
  const OfficialLogo = ({ className = "w-6 h-6", color = "currentColor" }) => (
    <svg viewBox="0 0 100 100" className={className} fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="65" cy="35" r="5" fill={color} fillOpacity="0.15" />
      <circle cx="85" cy="25" r="4" fill={color} fillOpacity="0.1" />
      <circle cx="80" cy="50" r="5" fill={color} fillOpacity="0.15" />
      <circle cx="60" cy="55" r="4" fill={color} fillOpacity="0.1" />
      <path d="M65 35L85 25M65 35L80 50M80 50L60 55" stroke={color} strokeOpacity="0.1" strokeWidth="1" />
      <path 
        d="M45 15C35 15 25 25 25 40C25 50 30 55 35 60C32 65 25 70 20 70M45 15C55 15 65 25 65 40C65 55 55 70 45 85C40 95 25 95 25 85C25 75 35 75 35 65" 
        stroke={color} 
        strokeWidth="4" 
        strokeLinecap="round" 
        strokeLinejoin="round" 
      />
    </svg>
  );

  const tabs = [
    { id: 'definition', label: 'Définition simple', icon: BookOpen },
    { id: 'clarification', label: 'Clarification concepts', icon: Brain },
    { id: 'quiz', label: 'Quiz Interactif', icon: CheckCircle },
    { id: 'aide', label: 'Aide à l\'étude', icon: Info },
  ];

  const handleSendMessage = (e) => {
    e.preventDefault();
    if (!inputValue.trim()) return;

    const newMessages = [...messages, { role: 'user', content: inputValue }];
    setMessages(newMessages);
    setInputValue('');

    setTimeout(() => {
      setMessages(prev => [...prev, { 
        role: 'bot', 
        content: "C'est une excellente question sur les mécanismes biologiques. Voici une explication structurée pour vous aider à mieux comprendre ce concept complexe..." 
      }]);
    }, 1000);
  };

  return (
    <div className="flex h-screen bg-slate-50 text-slate-800 font-sans overflow-hidden">
      {/* Background Bio Pattern */}
      <div className="fixed inset-0 opacity-[0.03] pointer-events-none">
        <svg width="100%" height="100%">
          <pattern id="dna-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">
            <path d="M30 10 Q 50 50 30 90 M70 10 Q 50 50 70 90" stroke="currentColor" fill="transparent" strokeWidth="2"/>
          </pattern>
          <rect width="100%" height="100%" fill="url(#dna-pattern)" />
        </svg>
      </div>

      <aside className={`${sidebarOpen ? 'w-80' : 'w-0'} bg-slate-900 text-white transition-all duration-300 flex flex-col relative z-20 shadow-xl overflow-hidden`}>
        {/* Header Sidebar */}
        <div className="p-6 border-b border-slate-800">
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-white p-1.5 rounded-lg shadow-lg">
              <OfficialLogo className="w-7 h-7" color="#0f172a" />
            </div>
            <h1 className="text-xl font-bold tracking-tight">BioTuteur</h1>
          </div>
          <span className="text-[10px] uppercase tracking-widest bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded border border-emerald-500/30">
            Version Développement
          </span>
        </div>

        <nav className="p-4 space-y-2 flex-1 overflow-y-auto custom-scrollbar">
          <p className="text-xs font-semibold text-slate-500 uppercase px-3 mb-2">Outils d'apprentissage</p>
          {tabs.map((tab) => (
            <button
              key={tab.id}
              onClick={() => setActiveTab(tab.id)}
              className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 ${
                activeTab === tab.id 
                  ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-900/40 translate-x-1' 
                  : 'text-slate-400 hover:bg-slate-800 hover:text-white'
              }`}
            >
              <tab.icon size={18} />
              <span className="text-sm font-medium">{tab.label}</span>
            </button>
          ))}

          <div className="pt-6">
            <p className="text-xs font-semibold text-slate-500 uppercase px-3 mb-2">Conversation</p>
            <div className="space-y-2">
              <button className="w-full flex items-center justify-between gap-2 px-4 py-2.5 rounded-lg border border-slate-700 text-sm hover:bg-slate-800 group transition-colors">
                <span className="flex items-center gap-2 italic text-slate-400 truncate">Nouvelle discussion...</span>
                <Plus size={16} className="text-emerald-500 group-hover:scale-110 transition-transform" />
              </button>
              
              <div className="flex gap-2">
                <button title="Enregistrer" className="flex-1 flex items-center justify-center gap-2 p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition-colors text-xs text-slate-300">
                  <Save size={14} /> Sauvegarder
                </button>
                <button title="Supprimer" className="flex items-center justify-center p-2 bg-red-500/10 text-red-400 rounded-lg hover:bg-red-500/20 transition-colors">
                  <Trash2 size={14} />
                </button>
              </div>
            </div>
          </div>

          <div className="pt-6">
            <p className="text-xs font-semibold text-slate-500 uppercase px-3 mb-2">Glossaire express</p>
            <div className="relative group mb-2 px-1">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-emerald-500 transition-colors" size={14} />
              <input 
                type="text"
                placeholder="Chercher un mot..."
                className="w-full bg-slate-800 border border-slate-700 rounded-lg py-2 pl-9 pr-3 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all"
                value={glossaryTerm}
                onChange={(e) => setGlossaryTerm(e.target.value)}
              />
            </div>
          </div>

          {/* Section Livres */}
          <div className="pt-6">
            <p className="text-xs font-semibold text-slate-500 uppercase px-3 mb-3">Livres utilisés pour BioTuteur</p>
            <div className="grid grid-cols-4 gap-2 px-3">
              {[
                "https://images.unsplash.com/photo-1544947950-fa07a98d237f?auto=format&fit=crop&q=80&w=200", 
                "https://images.unsplash.com/photo-1532012197367-2d20b571765c?auto=format&fit=crop&q=80&w=200", 
                "https://images.unsplash.com/photo-1589998059171-988d887df646?auto=format&fit=crop&q=80&w=200", 
                "https://images.unsplash.com/photo-1512820790803-83ca734da794?auto=format&fit=crop&q=80&w=200"
              ].map((url, i) => (
                <div key={i} className="aspect-[3/4] rounded-sm overflow-hidden bg-slate-800 border border-slate-700 hover:border-emerald-500 transition-colors cursor-pointer group shadow-sm">
                  <img src={url} alt={`Couverture ${i+1}`} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" />
                </div>
              ))}
            </div>
          </div>

          {/* Footer Sidebar avec Signature IA actualisée */}
          <div className="pt-4 pb-4 px-3 flex flex-col gap-3">
            <button className="w-full flex items-center justify-between group px-3 py-2 rounded-lg border border-emerald-500/20 bg-emerald-500/5 hover:bg-emerald-500/10 transition-all">
              <span className="text-[10px] font-bold text-emerald-400 uppercase tracking-widest">En savoir plus sur BioTuteur</span>
              <ExternalLink size={12} className="text-emerald-500 group-hover:translate-x-1 transition-transform" />
            </button>
            
            <div className="flex items-center justify-center gap-2 opacity-50 hover:opacity-90 transition-opacity cursor-default py-1">
              <div className="bg-[#D97757] p-0.5 rounded-sm flex items-center justify-center overflow-hidden">
                <img 
                  src="https://www-cdn.anthropic.com/images/4zrzovbb/website/46e4aa7ea208ed440d5bd9e9e3a0ee66bc336ff1-1000x1000.svg" 
                  alt="Anthropic" 
                  className="w-2.5 h-2.5"
                  onError={(e) => {e.target.style.display='none'}}
                />
              </div>
              <span className="text-[8px] font-bold text-slate-400 uppercase tracking-tight">
                Modèle d'IA : Sonnet 3.7 par Anthropic
              </span>
            </div>
          </div>
        </nav>

        <div className="p-4 border-t border-slate-800 bg-slate-900/50">
          <div className="flex items-center gap-3">
            <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-emerald-500 to-teal-400 flex items-center justify-center text-xs font-bold text-slate-900 shadow-inner">
              ET
            </div>
            <div>
              <p className="text-xs font-medium">Étudiant Cégep</p>
              <p className="text-[10px] text-slate-500">Session Hiver 2024</p>
            </div>
          </div>
        </div>
      </aside>

      <main className="flex-1 flex flex-col relative z-10">
        <header className="h-16 bg-white/80 backdrop-blur-md border-b border-slate-200 flex items-center justify-between px-6 sticky top-0">
          <div className="flex items-center gap-4">
            <button 
              onClick={() => setSidebarOpen(!sidebarOpen)}
              className="p-2 hover:bg-slate-100 rounded-lg transition-colors text-slate-600"
            >
              {sidebarOpen ? <X size={20} /> : <Menu size={20} />}
            </button>
            <div>
              <h2 className="text-lg font-semibold text-slate-800">
                {tabs.find(t => t.id === activeTab)?.label}
              </h2>
              <div className="flex items-center gap-1 text-[10px] text-slate-400 uppercase tracking-wider">
                <span>Biologie Moléculaire</span>
                <ChevronRight size={10} />
                <span>Clarification</span>
              </div>
            </div>
          </div>

          <div className="flex items-center gap-4">
             <div className="hidden sm:flex items-center gap-2 px-3 py-1.5 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-100 shadow-sm">
               <span className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></span>
               Assistant Actif
             </div>
             <button className="p-2 hover:bg-slate-100 rounded-full text-slate-500 transition-colors">
               <Leaf size={20} />
             </button>
          </div>
        </header>

        <div className="flex-1 overflow-y-auto p-6 space-y-6">
          <div className="max-w-3xl mx-auto space-y-6">
            {messages.map((msg, idx) => (
              <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in slide-in-from-bottom-3 duration-500`}>
                <div className={`flex gap-4 max-w-[85%] ${msg.role === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                  <div className={`w-8 h-8 rounded-lg flex-shrink-0 flex items-center justify-center shadow-sm ${
                    msg.role === 'user' ? 'bg-slate-200 text-slate-600' : 'bg-emerald-600 text-white'
                  }`}>
                    {msg.role === 'user' ? <Plus size={16} /> : <Microscope size={16} />}
                  </div>
                  <div className={`p-4 rounded-2xl shadow-sm border ${
                    msg.role === 'user' 
                      ? 'bg-emerald-600 border-emerald-500 text-white rounded-tr-none' 
                      : 'bg-white border-slate-200 text-slate-700 rounded-tl-none'
                  }`}>
                    <p className="text-sm leading-relaxed whitespace-pre-wrap">{msg.content}</p>
                    {msg.role === 'bot' && (
                      <div className="mt-3 pt-3 border-t border-slate-100 flex gap-4">
                        <button className="text-[10px] font-bold text-emerald-600 hover:text-emerald-700 uppercase tracking-widest transition-colors">Voir les sources</button>
                        <button className="text-[10px] font-bold text-slate-400 hover:text-slate-600 uppercase tracking-widest ml-auto transition-colors">Signaler une erreur</button>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className="p-6 bg-white border-t border-slate-200 shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.05)]">
          <form onSubmit={handleSendMessage} className="max-w-3xl mx-auto">
            <div className="relative group">
              <textarea 
                className="w-full bg-slate-50 border border-slate-200 rounded-2xl py-4 pl-5 pr-14 text-sm focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-all min-h-[60px] max-h-[200px] resize-none shadow-inner"
                placeholder="Posez votre question sur un concept biologique..."
                rows="1"
                value={inputValue}
                onChange={(e) => setInputValue(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage(e);
                  }
                }}
              ></textarea>
              <button 
                type="submit"
                className="absolute right-3 bottom-3 p-2 bg-emerald-600 text-white rounded-xl hover:bg-emerald-700 shadow-md shadow-emerald-600/20 disabled:opacity-50 transition-all"
                disabled={!inputValue.trim()}
              >
                <ChevronRight size={20} />
              </button>
            </div>
          </form>
        </div>
      </main>

      <style dangerouslySetInnerHTML={{ __html: `
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.2); }
      `}} />
    </div>
  );
};

export default App;
